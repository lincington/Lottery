<?xml version="1.0" encoding="utf-8" ?>
<configuration>

  <nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        autoReload="true"
		archiveEvery="true"
        internalLogLevel="Warn"
        internalLogFile="internal-nlog.txt">
	  <!--Nlog 文档参考地址：https://github.com/NLog/NLog/wiki-->
	  <!--internalLogLevel Nlog内部日志记录为Off关闭。除非纠错，不可以设为Trace否则速度很慢，起码Debug以上-->
	  <!--自定义日志输出文件路径及命名规则-->
	  <variable name="logDir" value="${basedir}/nlogs/${date:format=yyyyMMdd}/${level}.log"/>

	  <!--define various log targets-->
	  <targets async="true">
		  <!--写入文件-->
		  <!--滚动日志文件上限数，滚动日志文件数达到上限新的文件内容会覆盖旧文件内容 -->
		  <!--archiveAboveSize每个日志文件大小的最大值（单位：字节），主日志文件超过大小超过该值时会将文件内容写入滚动日志并清空主日志文件内容-->
		  <!--${basedir}表示当前应用程序域所在的根目录-->
		  <target name="allfile" xsi:type="File"
				  fileName="${basedir}/nlogs/all.txt"
				  archiveFileName="${basedir}/nlogs/all.{###}.txt"
				  archiveEvery="Day"
				  archiveNumbering="DateAndSequence"
				  archiveAboveSize="200000"
				  maxArchiveFiles="30"
				  keepFileOpen="true"
				  layout="${longdate} | ${event-properties:item=EventId_Id} | ${uppercase:${level}} | ${logger} | ${aspnet-request-iP:CheckForwardedForHeader=true} | ${event-properties:item=user} | ${aspnet-request-url} | ${message} | ${event-properties:item=requestParam} | ${event-properties:item=jsonResult} | ${onexception:${exception:format=tostring}"/>

		  <!--SQL-->
		  <target name="sqlfile" xsi:type="File"
			  fileName="${basedir}/nlogs/all-sql.txt"
			  archiveFileName="${basedir}/nlogs/all.sql{###}.txt"
			  archiveEvery="Day"
			  archiveNumbering="DateAndSequence"
			  archiveAboveSize="20000"
			  maxArchiveFiles="30"
			  keepFileOpen="false"
			  layout="${newline} ${longdate} - ${aspnet-request-iP} - ${aspnet-request-headers:HeaderNames=userid} - ${aspnet-request-url} ${newline} ${message}"/>

		  <!--写入控制台-->
		  <target name="console" xsi:type="ColoredConsole" layout="${date:format=MM-dd HH\:mm\:ss} | ${uppercase:${level}} | ${logger} | ${aspnet-request-iP} | ${aspnet-request-url} | ${message}"/>
		  <!--SQL写入控制台-->
		  <target name="consoleSql" xsi:type="ColoredConsole" layout="${date:format=MM-dd HH\:mm\:ss} | ${aspnet-request-url} ${newline} ${message}"/>
		  <!--写入黑洞-->
		  <target name="blackhole" xsi:type="Null" />
		  <!-- 输出到文件 -->
		  <target xsi:type="File" name="file" fileName="logs/app.log"
				  layout="${longdate}|${level:uppercase=true}|${logger}|${message}" />
		  <!-- 输出到控制台 -->
		  <target xsi:type="Console" name="console"
				  layout="${longdate}|${level:uppercase=true}|${logger}|${message}" />
		  <!-- write logs to file -->
		  <default-wrapper xsi:type="BufferingWrapper" bufferSize="100"/>
		  <target xsi:type="File" name="ownFile-web" fileName="nlogs/nlog-own-${shortdate}.log" layout="${longdate} | ${message}"  archiveAboveSize="1048576"/>
	  </targets>
	  <!--define various log rules-->
	  <rules>
		  <!-- 所有日志都输出到文件 -->
		  <logger name="*" minlevel="Info" writeTo="file" />
		  <!-- 错误及以上级别日志输出到控制台 -->
		  <logger name="*" minlevel="Error" writeTo="console" />
		  <!-- 除非调试需要，把 .NET Core 程序集的 Debug 输出都屏蔽 Trace -> Debug-> Info ->Warn-> Error-> Critical-->
		  <!--All logs, including from Microsoft-->
		  <logger name="*" minlevel="Trace" writeTo="allfile" />
		  <!-- 除非调试需要，把系统的 Debug 输出都屏蔽 -->
		  <logger name="*" minLevel="Debug" writeTo="console"/>
		  <!--跳过所有级别的Microsoft组件的日志记录-->
		  <logger name="Microsoft.*" writeTo="blackhole" final="true" />
		  <!--<logger name="System.*" writeTo="blackhole" final="true" />-->
		  <logger name="*" minlevel="Trace" writeTo="ownFile-web" />		  
	  </rules>
  </nlog>
</configuration>